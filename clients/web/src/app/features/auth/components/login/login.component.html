<div class="auth-card">
  <!-- Step Indicator -->
  <div class="step-indicator">
    <div class="step-dot" [class.active]="step() === 'email'" [class.completed]="step() === 'otp'"></div>
    <div class="step-line" [class.active]="step() === 'otp'"></div>
    <div class="step-dot" [class.active]="step() === 'otp'"></div>
  </div>

  <!-- Header -->
  <div class="auth-header">
    @if (step() === 'email') {
      <h2 class="auth-title">Welcome back</h2>
      <p class="auth-subtitle">Sign in to your family hub</p>
    } @else {
      <h2 class="auth-title">Check your email</h2>
      <p class="auth-subtitle">We sent a code to <strong>{{ email }}</strong></p>
    }
  </div>

  <!-- Error Alert -->
  @if (error()) {
    <div class="auth-error">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 8v4M12 16h.01"/>
        </svg>
      </div>
      <span>{{ error() }}</span>
    </div>
  }

  <!-- Email Step -->
  @if (step() === 'email') {
    <form (ngSubmit)="requestOtp()" class="auth-form">
      <div class="form-group">
        <label for="email" class="form-label">Email address</label>
        <div class="input-wrapper">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          <input
            id="email"
            name="email"
            type="email"
            autocomplete="email webauthn"
            required
            [(ngModel)]="email"
            class="auth-input"
            placeholder="you@example.com"
            [disabled]="isLoading()"
          />
        </div>
      </div>

      <button
        type="submit"
        class="auth-button primary"
        [disabled]="isLoading() || !email"
      >
        @if (isLoading()) {
          <span class="button-spinner"></span>
          <span>Sending...</span>
        } @else {
          <span>Continue with Email</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        }
      </button>

      @if (passkeySupported()) {
        <div class="auth-divider">
          <span>or continue with</span>
        </div>

        <button
          type="button"
          (click)="authenticateWithPasskey()"
          class="auth-button passkey"
          [disabled]="isLoading()"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0110 0v4"/>
            <circle cx="12" cy="16" r="1"/>
          </svg>
          <span>Sign in with Passkey</span>
        </button>
      }
    </form>
  }

  <!-- OTP Step -->
  @if (step() === 'otp') {
    <form (ngSubmit)="verifyOtp()" class="auth-form">
      <div class="form-group">
        <label for="otp" class="form-label">Verification code</label>
        <div class="otp-input-wrapper">
          <input
            id="otp"
            name="otp"
            type="text"
            inputmode="numeric"
            autocomplete="one-time-code"
            required
            [(ngModel)]="otpCode"
            class="otp-input"
            placeholder="000000"
            maxlength="6"
            [disabled]="isLoading()"
          />
        </div>
      </div>

      <button
        type="submit"
        class="auth-button primary"
        [disabled]="isLoading() || otpCode.length < 6"
      >
        @if (isLoading()) {
          <span class="button-spinner"></span>
          <span>Verifying...</span>
        } @else {
          <span>Verify Code</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 13l4 4L19 7"/>
          </svg>
        }
      </button>

      <div class="auth-links">
        <button
          type="button"
          (click)="backToEmail()"
          class="link-button"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          <span>Use different email</span>
        </button>
        <button
          type="button"
          (click)="resendOtp()"
          class="link-button accent"
          [disabled]="isLoading()"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 2v6h-6M3 12a9 9 0 0115.4-6.6L21 8M3 22v-6h6M21 12a9 9 0 01-15.4 6.6L3 16"/>
          </svg>
          <span>Resend code</span>
        </button>
      </div>
    </form>
  }

  <!-- Register Link -->
  <div class="auth-footer">
    <span>New to Luminous?</span>
    <a routerLink="/auth/register" class="footer-link">Create an account</a>
  </div>
</div>
